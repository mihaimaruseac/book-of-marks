name: Haskell CI with Stack

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
    types: [opened, synchronize]

permissions: {}

jobs:
  test:
    name: Test job
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout code"
        uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # v3.2.0
        with:
          persist-credentials: false

      - name: Remove .git
        run: rm -rf .git

      - name: List everything (pre)
        run: tree -alps .

      - name: List Haskell binaries (pre)
        run: |
          echo 'Stack: '
          which stack || true
          stack --version || true
          echo 'GHC{,i}: '
          stack exec -- ghc --version || true
          stack exec -- ghci --version || true

      - name: Setup Haskell Compiler (stack)
        uses: haskell/actions/setup@93635e8c4ac823f55cf3444537a63d3f2fd589de # v2.1.0
        with:
          enable-stack: true
          stack-no-global: true
          stack-setup-ghc: true

      - name: List everything (post)
        run: tree -alps .

      - name: List Haskell binaries (post)
        run: |
          echo 'Stack: '
          which stack || true
          stack --version || true
          echo 'GHC{,i}: '
          stack exec -- ghc --version || true
          stack exec -- ghci --version || true
